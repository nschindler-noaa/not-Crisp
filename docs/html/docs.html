<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>COMPASS Source Code: Documenting the Code</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<h1><a class="anchor" name="docs">Documenting the Code</a></h1>This page documents how this documentation is generated from the code (see <a class="el" href="docs.html#doxygen">Generating Documentation with Doxygen</a>) and how to document code for future use (see <a class="el" href="docs.html#doc_code">Documenting the Code</a>).<p>
There is also information on where to find additional documentation that was created before the in-code documentation was set up (see <a class="el" href="docs.html#doc_extra">doc_extra</a>).<h2><a class="anchor" name="doxygen">
Generating Documentation with Doxygen</a></h2>
The Doxygen documentation tool is used to generate documentation from the actual COMPASS source code. Actually adding documentation in the code is described in <a class="el" href="docs.html#doc_code">Documenting the Code</a> and not here. Doxygen is free software under the GNU GPL license and can be downloaded from a number of sources (a web search for Doxygen should work fine for finding the home page).<p>
The Doxygen tool is mainly command line based but it also has a simple GUI for running the application (which coincidentally uses Trolltech's Qt library like COMPASS). The configuration information which is used to determine what files to parse and where to place the documentation is stored in a file called "Doxyfile" which is part of the COMPASS source. The configuration file uses relative paths so the actual application should be <a class="el" href="structrun.html" title="Entire run parameters.">run</a> from the top level directory of the COMPASS source code (the Doxygen GUI has a clear option for specifying the working directory).<p>
Here is an example of checking out the COMPASS source code and generating the HTML documentation from the code: <div class="fragment"><pre class="fragment"><span class="preprocessor"># Check out the source code</span>
<span class="preprocessor"></span>cvs -d :ext:gandhi.cbr.washington.edu:/var/lib/cvs export -r NOT_CRISP crisp
cd crisp        # Enter the COMPASS source directory
doxygen         # Run Doxygen
ls docs/html    # Show the generated files
</pre></div><p>
Note that on Windows since you wouldn't use the command line you would probably checkout the source code using a Windows CVS client and then open Doxygen's GUI, load the Doxyfile, set the working directory, and then generate the documentation.<h2><a class="anchor" name="doc_code">
Documenting the Code</a></h2>
This section explains how to document the source code such that the documentation can be parsed using Doxygen to generate HTML documentation such as this.<p>
Although a lot of the COMPASS source code has documentation, sometimes it is located in unusual places (e.g. a separate Word docoument) or completely absent. To aid in these problems, Doxygen (see <a class="el" href="docs.html#doxygen">Generating Documentation with Doxygen</a>) is now used to generate code documentation straight from the source code while hopefully providing enough power that outside documentation is less necessary. This helps to keep the documentation close to the code to make it harder to forget that changes and algorithms should be documented as soon as possible.<p>
Doxygen has helpful documentation which can be found on the Doxygen web site (and is usually installed along with Doxygen). The main points to keep in mind are the following:<ul>
<li>Doxygen only parses comments that are in special documentation comment blocks. These look like Javadoc documentation blocks (i.e. "/ * *" without the spaces starts a documentation block and "* /" without the space ends the block).</li><li>Doxygen only puts documented functions/structures/fields/classes into the documentation rather than just everything. This option can be changed if it would be helpful and is described in the Doxygen documentation.</li><li>Doxygen will only add documentation for members defined in files that have a comment block with a "\file" directive in them.</li><li>To be clear, EVERY FILE WITH ANY DOCUMENTATION SHOULD HAVE A "\file" DIRECTIVE IN IT.</li><li>Documentation can be placed before a member or after the member on the same line.</li><li>The \brief command can be used to specify the brief description for a member although it is set to automatically assume the first sentence is the brief description (as in Java).</li><li>Directives suchs as \return and \param work just as in Javadocs.</li><li>Pages and sections can be created using "\page id The Title" or "\section id A Section" where "id" is a textual name.</li><li>Pages and sections can be references elsewhere using "\ref id" where "id" is that textual name described above.</li><li>Formulas can be included using LaTeX and the \f$ ... \f$ directives (where the ellipsis represents the formula to include). There is an example of this in <a class="el" href="classq_i_o_dam_passage_cell.html" title="Generic cell for displaying some passage-related information at a specific dam.">qIODamPassageCell</a>.</li></ul>
<p>
Here is an example (note the use of \section and \ref): <div class="fragment"><pre class="fragment">
/** \file
 * \brief This file is an example of using comments.
 *
 * Comment blocks in Doxygen start with slash, star, star and end with star, slash. There are also examples of a few other features (one example is \ref example_section).
 *
 * \section example_section An Example Section
 * This section is just shown as an example. Usually you would want more material if you were going to make a section.
 */

/** Get a number. This method returns a number. The number also happens to be 1.
 * \param p A parameter that's not used.
 * \return A number.
 */
int get_number(int p) {
	/* This only has 1 star for the comment block so it is not parsed by Doxygen. */
	return 1;
}

/** This is a structure example. */
struct test {
	int p1; /** Field 1. */
	int p2; /** Field 2. */
};
</pre></div><p>
When in doubt consult the Doxygen documentation or the actual documentation in the COMPASS source code.<p>
For the main pages of documentation, rather than include them in an odd place I put them in a series of "*.dox" files which are also parsed by Doxygen. Doxygen parses them like C code so you still have to put everything in comment blocks. For example this file is "doc-source.dox".<h2><a class="anchor" name="doc_extra">
doc_extra</a></h2>
There are a bunch of Word documents describing various changes and what they are for in the COMPASS directory on my desktop (~jkrinke/Desktop) in Windows on VMware. They describe things like the new dam delay support well. In the future it would be a good idea to attempt to write that kind of documentation actually in the code (since even equations can be put in with Doxygen), but I never had enough time to make that conversion. These documents are also in ~jkrinke/compass-docs on gandhi.cbr.washington.edu. <hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 4 10:53:44 2008 for COMPASS Source Code by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
