<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>COMPASS Source Code: report_altern.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<h1>report_altern.c File Reference</h1>Report functions specific to the alternative report tool. <a href="#_details">More...</a>
<p>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;sys/times.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &quot;<a class="el" href="crisp_8h.html">crisp.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="log_8h.html">log.h</a>&quot;</code><br>
<code>#include &quot;report.h&quot;</code><br>
<code>#include &quot;<a class="el" href="struct__at_8h.html">struct_at.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="alt__report_8h.html">alt_report.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="monte__index_8h.html">monte_index.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="tree_8h.html">tree.h</a>&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="9c7dea77661ba4de4bdacc20f250ed43"></a><!-- doxytag: member="report_altern.c::LIST_SIZE_GUESS" ref="9c7dea77661ba4de4bdacc20f250ed43" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#9c7dea77661ba4de4bdacc20f250ed43">LIST_SIZE_GUESS</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A guess at the initial number of alternatives to be found in the current directory. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#c7ac544fc08f3a794f4e08af8a01430e">ALTERN_MAX_SIZE</a>&nbsp;&nbsp;&nbsp;124</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The maximum length of an alternative name.  <a href="#c7ac544fc08f3a794f4e08af8a01430e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="838435c2f83408f3809754a8dc9870c9"></a><!-- doxytag: member="report_altern.c::RLS_STRING_ADD" ref="838435c2f83408f3809754a8dc9870c9" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#838435c2f83408f3809754a8dc9870c9">RLS_STRING_ADD</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The number of characters by which the <a class="el" href="structrelease.html" title="Release parameters.">release</a> <a class="el" href="structspecies.html" title="Species parameters.">species</a> follows the <a class="el" href="structrelease.html" title="Release parameters.">release</a> location in the release_list stings. <br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="fd857c61c184ce8a8998fa45aa699f7c"></a><!-- doxytag: member="report_altern.c::altern_exists" ref="fd857c61c184ce8a8998fa45aa699f7c" args="(char *altern)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#fd857c61c184ce8a8998fa45aa699f7c">altern_exists</a> (char *altern)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true if there is an element in the alternative tree whose name matches altern, false otherwise. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#e7a982dd0664c6468bd75d728bec2ee9">report_update_altern</a> (char *name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Updates the report_list for the named alternative.  <a href="#e7a982dd0664c6468bd75d728bec2ee9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="247848b90fa2f83b4b7ddfb8642b0da3"></a><!-- doxytag: member="report_altern.c::report_update_directory" ref="247848b90fa2f83b4b7ddfb8642b0da3" args="()" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#247848b90fa2f83b4b7ddfb8642b0da3">report_update_directory</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Updates the alternatives in the current directory, parsing alternatives found there. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">report_struct *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#6a028ab9e01e8accd92ee5096bdab940">get_output_list</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A simple wrapper function to ensure that we don't have two copies of the list.  <a href="#6a028ab9e01e8accd92ee5096bdab940"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5d41eb89b8dc01537665181a30128017"></a><!-- doxytag: member="report_altern.c::get_output_index" ref="5d41eb89b8dc01537665181a30128017" args="()" -->
report_struct *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#5d41eb89b8dc01537665181a30128017">get_output_index</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wrapper function for alternrelease_list, uses a static pointer to avoid reinitialization. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="2b2c896d6993b19ce19b4274df982315"></a><!-- doxytag: member="report_altern.c::get_output_index2" ref="2b2c896d6993b19ce19b4274df982315" args="()" -->
report_struct *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#2b2c896d6993b19ce19b4274df982315">get_output_index2</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The function to return a pointer to the static global altern_output_index2. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#db7b11dfea05868f0216c04e67d140a0">get_altern_year</a> (char *name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns all calculable output data based on the given alternative.  <a href="#db7b11dfea05868f0216c04e67d140a0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="aa9bec55181847d0e064739798e31d54"></a><!-- doxytag: member="report_altern.c::free_at_struct_results" ref="aa9bec55181847d0e064739798e31d54" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#aa9bec55181847d0e064739798e31d54">free_at_struct_results</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Frees the static copy of the last set of results calculated by get_altern_year. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b063bb02c32652bcbe61712693ae3a4b"></a><!-- doxytag: member="report_altern.c::altern_report_account_for" ref="b063bb02c32652bcbe61712693ae3a4b" args="(char *name)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#b063bb02c32652bcbe61712693ae3a4b">altern_report_account_for</a> (char *name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Make sure that the altern_list reflects the current alternative. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="report__altern_8c.html#e2d0a1ab298096196efcdc550f3cddc8">altern_report_output_loop</a> (FILE *fp, struct report_var *variables, char *vars_set, void *data_ptr, struct output_array *array_info)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Kludge to make alternative reports work better.  <a href="#e2d0a1ab298096196efcdc550f3cddc8"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Report functions specific to the alternative report tool. 
<p>
This module uses the genericized report frame to create a tabular report of monte carlo alternative output data for specified alternatives living in the current directory. The main incompatabilities between the alternative report and the generic report tool are that calculations must be made at the time of report generation, so multiple additions must be made when a variable is added, and the addition of a fourth list item.<p>
When adding a new alternative report variable, an entry must be added to the struct <a class="el" href="structalt__data.html" title="Data structure for the report tool that holds alternative data.">alt_data</a> (in <a class="el" href="alt__report_8h.html" title="Alternative data structure for use in the report tool.">alt_report.h</a>) and since we never output these variables as we do input data, the text name of each variable must also be added there; the usual entry in "report_init.c" must be added; and the appropriate calculation routines must be called in the function accumulate_data() in this file.<p>
Information on the generic report frame on which this tool is built can be found in <a class="el" href="report__frame_8c.html" title="GUI functions have been moved to ZatDataReportTool.cpp - some utility functions remain...">report_frame.c</a><p>
Because there is a great deal of calculation involved in both the initialization (reading and parsing all available alternatives found in the current directory) and <a class="el" href="structrun.html" title="Entire run parameters.">run</a> (summarizing the output data for all selected alternatives) phases of the alternative report, effort is taken to ensure that recalculation is performed only when necessary.<p>
Although some care is taken in this regard, there is yet room for improvement. The initialization of the alternative report tool causes the tool to read the current directory, looking for directories which contain a file with the name directoryname.out. These files are assumed to contain monte carlo alternative output data, and the monte index file "directoryname.ind" in each directory is read and parsed into a static pointer to a dynamically allocated array of <a class="el" href="structat__struct.html" title="I don't know what this is.">at_struct</a> pointers. As it does this, it stores the last changed time of the current directory, which it later checks against to determine if a reinitialization is required. (Maximum safety would maintain a list of the change time of all alternative output data files.)<p>
Various stages of initialization require the creation of lists of viable alternative-years, releases, and segments from these structures. These lists are also kept around, and freed and reinitialized when the list_alternatives() function demands an update. These functions all maintain static pointers which are freed and zeroed by the clear_report_alternative_statics() function, which is called in list_alternatives() when a reinitialization is performed.<p>
The data tabulation is done in process_year(), called in the wrapper function <a class="el" href="report__altern_8c.html#db7b11dfea05868f0216c04e67d140a0" title="Returns all calculable output data based on the given alternative.">get_altern_year()</a>, which maintains a static pointer to the last altern-year data, reusing it if applicable, freeing the pointer and calculating the new data if not. This function is called whenever the report frame requires data for a specific altern-year, which may, unfortunately require some recalculation for short line lengths, as the report frame tends to labor under the assumption that the data values returned are those that linger, rather than those which are calculated. <hr><h2>Define Documentation</h2>
<a class="anchor" name="c7ac544fc08f3a794f4e08af8a01430e"></a><!-- doxytag: member="report_altern.c::ALTERN_MAX_SIZE" ref="c7ac544fc08f3a794f4e08af8a01430e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALTERN_MAX_SIZE&nbsp;&nbsp;&nbsp;124          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The maximum length of an alternative name. 
<p>
Alternatives with longer names than this will have undefined consequences (and will likely cause the tool to dump core). 
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="e2d0a1ab298096196efcdc550f3cddc8"></a><!-- doxytag: member="report_altern.c::altern_report_output_loop" ref="e2d0a1ab298096196efcdc550f3cddc8" args="(FILE *fp, struct report_var *variables, char *vars_set, void *data_ptr, struct output_array *array_info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void altern_report_output_loop           </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct report_var *&nbsp;</td>
          <td class="paramname"> <em>variables</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>vars_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct output_array *&nbsp;</td>
          <td class="paramname"> <em>array_info</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Kludge to make alternative reports work better. 
<p>
Ordinarily, this function is dealt with in the <a class="el" href="report__frame_8c.html" title="GUI functions have been moved to ZatDataReportTool.cpp - some utility functions remain...">report_frame.c</a> function write_data, but the report tool needed a kludge to make it work smoothly as the alternative report, and this function is the seam. If the report tool needs to be reworked to be truly general for 4 list selections, then the functionality provided by this function will need to be integrated. (How, I have no idea.)<p>
The whole problem with this function is the fact that we are using a single dimensional array to accumulate all the data for a single alternative-year (two dimensional has problems, too, but they are buried a bit deeper), and thus the offset for index_list is variable in length (the number of elements in index2), requiring a specialized output function. 
</div>
</div><p>
<a class="anchor" name="db7b11dfea05868f0216c04e67d140a0"></a><!-- doxytag: member="report_altern.c::get_altern_year" ref="db7b11dfea05868f0216c04e67d140a0" args="(char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* get_altern_year           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns all calculable output data based on the given alternative. 
<p>
The name contains the string representation of an alternative name followed by the constant string year and the year number (with 1 added to the actual index into the years array of the alternative), ie "altern1, year 1" represents data from the alternative named altern1, index 0 into the years array.<p>
Output data is stored in a static variable which is freed every time this function is called, unless name matches the last name used. (altern-year combination is equivalent.) 
</div>
</div><p>
<a class="anchor" name="6a028ab9e01e8accd92ee5096bdab940"></a><!-- doxytag: member="report_altern.c::get_output_list" ref="6a028ab9e01e8accd92ee5096bdab940" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct report_struct* get_output_list           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
A simple wrapper function to ensure that we don't have two copies of the list. 
<p>
The pointer altern_output_list is a static global. 
</div>
</div><p>
<a class="anchor" name="e7a982dd0664c6468bd75d728bec2ee9"></a><!-- doxytag: member="report_altern.c::report_update_altern" ref="e7a982dd0664c6468bd75d728bec2ee9" args="(char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int report_update_altern           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Updates the report_list for the named alternative. 
<p>
Returns 1 on successful completion, 0 if a memory allocation fails, and -1 if it can't read the index file. 
</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 4 10:53:43 2008 for COMPASS Source Code by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
